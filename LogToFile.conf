input {
    beats {
        port => 5044
    }
}
filter {
    mutate {
        remove_field => [
            "@version",
            "@metadata",
            "ecs",
            "host",
            "agent",
            "tags",
            "input",
            "@timestamp" ,
            "@metadata",
            "log"
        ]
    }
}
filter {
  ruby {
    # Cancel 90% of events
    code => "
    lengthChar = event.get('message').length
        if lengthChar < 100
            event.cancel
        end
    "
  }
    grok {
        match => { "message" => '%{HTTPD_COMBINEDLOG}' }
    }
    mutate {
        gsub => [
            "agent",'"',"",
            "referrer",'"',""
        ]
        convert => {
            "response"=>"integer"
        }
        remove_field => ["message"]
    }
}
output {
    stdout {
        codec => rubydebug 
    }
}